
com=window.com||{};com.marklogic=window.com.marklogic||{};com.marklogic.widgets=window.com.marklogic.widgets||{};com.marklogic.widgets.addressbar=function(container){this.container=container;this._geo=mljs.defaultconnection.createGeoContext();this._qb=mljs.defaultconnection.createQuery();this._geocoder=new google.maps.Geocoder();this._config={radius:5,radiusMeasure:"mi"};this._init();};com.marklogic.widgets.addressbar.getConfigurationDefinition=function(){var self=this;return{radius:{type:"positiveInteger",default:5,title:"Radius",description:"Radius from point to contribute to query."},radiusMeasure:{type:"enum",default:"mi",title:"Radius Measure",description:"Measuring unit used for radius",options:[{value:"mi",title:"Statute Miles",description:"Standard (statute) miles."},{value:"nm",title:"Nautical Miles",description:"Nautical Miles."},{value:"km",title:"Kilometres",description:"Kilometres."},{value:"m",title:"Metres",description:"Metres."},{value:"degrees",title:"Degrees",description:"Degrees of Arc. 1 degree = 60nm."}]}};};com.marklogic.widgets.addressbar.prototype.setConfiguration=function(config){for(var prop in config){this._config[prop]=config[prop];}};com.marklogic.widgets.addressbar.prototype.setGeoContext=function(ctx){this._geo=ctx;};com.marklogic.widgets.addressbar.prototype._init=function(){var s="<div class='mljswidget well address'>";s+="<div class='input-append input-prepend'>";s+="<span class='address-text'>Address: </span><input id='"+this.container+"-address' class='span2 addressbar-address' type='text' size='20' />";s+="<button class='btn btn-primary addressbar-submit' type='submit' id='"+this.container+"-submit'>Search</button>";s+="</div></div>";document.getElementById(this.container).innerHTML=s;var button=document.getElementById(this.container+"-submit");var self=this;button.onclick=function(evt){self._dosearch();evt.stopPropagation();return false;};var searchKeyPress=function(e){if(typeof e=='undefined'&&window.event){e=window.event;}
if(e.keyCode==13){button.click();}};document.getElementById(this.container+"-address").onkeypress=searchKeyPress;};com.marklogic.widgets.addressbar.prototype.radius=function(radius,radiusMeasure){this._radius=radius;this._radiusMeasure=radiusMeasure;return this;};com.marklogic.widgets.addressbar.prototype._dosearch=function(){var self=this;var address=document.getElementById(this.container+"-address").value;if(null==address||""==address){self._geo.contributeArea(self.container,null);return;}
this._geocoder.geocode({'address':address},function(results,status){console.log("Results: "+JSON.stringify(results));if(status==google.maps.GeocoderStatus.OK){var pos=results[0].geometry.location;var lat=pos.d||pos.k;var lon=pos.e||pos.A;console.log("Results: pos: "+JSON.stringify(pos)+" := lat: "+lat+", lon: "+lon);var circle=self._qb.circleDef(lat,lon,self._radius,self._radiusMeasure);self._geo.contributeArea(self.container,circle);}else{alert("Could not look up address for the following reason: "+status);}});};