
com=window.com||{};com.marklogic=window.com.marklogic||{};com.marklogic.widgets=window.com.marklogic.widgets||{};com.marklogic.widgets.workplace=function(container){this.container=container;this._editable=false;this._contexts=new Array();this._workplaceContext=new com.marklogic.widgets.workplacecontext();this._init();this._workplaceContext.register(this);};com.marklogic.widgets.workplace.prototype.getWorkplaceContext=function(){return this._workplaceContext;};com.marklogic.widgets.workplace.prototype.setWorkplaceContext=function(ctx){this._workplaceContext=ctx;this.updateWorkplace();};com.marklogic.widgets.workplace.prototype._init=function(){var str="<div id='"+this.container+"-container' class='workplace-container'>";str+=" <div id='"+this.container+"-layout'></div>";str+=" <div id='"+this.container+"-mask' class='workplace-mask'>";str+="  <div class='workplace-mask-icon' ><img id='"+this.container+"-link' src='/images/mljs/setting-small.png' title='Edit this Workplace' class='workplace-edit-link' /></div>";str+=" </div>";str+="</div>";document.getElementById(this.container).innerHTML=str;var self=this;document.getElementById(this.container+"-link").onclick=function(evt){com.marklogic.widgets.workplaceadmin.renderFullscreen(self._workplaceContext);};};com.marklogic.widgets.workplace.prototype.editable=function(editme){if(undefined==editme){editme=true;}
this._editable=editme;if(this._editable){document.getElementById(this.container+"-mask").style.display="block";}else{document.getElementById(this.container+"-mask").style.display="none";}};com.marklogic.widgets.workplace.prototype.loadPage=function(jsonOrString,json_opt){this._workplaceContext.loadPage(jsonOrString,json_opt);};com.marklogic.widgets.workplace.prototype.updateWorkplace=function(context){var json=this._workplaceContext.getJson();mljs.defaultconnection.logger.debug("Creating layout");var layout=new(com.marklogic.widgets.layouts[json.layout])(this.container+"-layout");mljs.defaultconnection.logger.debug("Creating zones");layout.createZones(json.assignments);var widgets=new Array();mljs.defaultconnection.logger.debug("Creating widget instances");for(var w=0,max=json.widgets.length,widget;w<max;w++){widget=json.widgets[w];mljs.defaultconnection.logger.debug("Creating widget: "+w+" with: "+JSON.stringify(widget));var item=layout.getAssignmentByWidgetName(widget.widget).item;var elementid=item.elementid;var wgt=this._createWidget(widget.type,elementid,widget.config);mljs.defaultconnection.logger.debug("Create widget has returned");widgets[widget.widget]=wgt;}
var contexts=new Array();mljs.defaultconnection.logger.debug("Creating contexts");for(var c=0,max=json.contexts.length,ctx;c<max;c++){ctx=json.contexts[c];mljs.defaultconnection.logger.debug("Context: "+c+" is "+JSON.stringify(ctx));var creator=mljs.defaultconnection["create"+ctx.type];mljs.defaultconnection.logger.debug("Is creator function of type function?: "+(typeof creator));var inst=creator.call(mljs.defaultconnection);contexts[ctx.context]=inst;mljs.defaultconnection.logger.debug("Is context instance valid?: is object?: "+(typeof inst));mljs.defaultconnection.logger.debug("Config: "+JSON.stringify(ctx.config));mljs.defaultconnection.logger.debug("Context Obj: "+JSON.stringify(inst));if(undefined!=inst.setConfiguration&&undefined!=ctx.config){mljs.defaultconnection.logger.debug("Setting context configuration");inst.setConfiguration(ctx.config);}
for(var wid=0,widmax=ctx.register.length,widgetid;wid<widmax;wid++){widgetid=ctx.register[wid];mljs.defaultconnection.logger.debug("registering widget: "+wid+" to "+widgetid);inst.register(widgets[widgetid]);}}
this._contexts=contexts;if(undefined!=json.actions&&undefined!=json.actions.onload){mljs.defaultconnection.logger.debug("Processing onload actions");for(var a=0,max=json.actions.onload.length,action;a<max;a++){action=json.actions.onload[a];mljs.defaultconnection.logger.debug("Processing onload action: "+JSON.stringify(action));var actionObject=new(com.marklogic.widgets.actions[action.type])();mljs.defaultconnection.logger.debug("Got instance. Calling setConfiguration()...");actionObject.setConfiguration(action.config);mljs.defaultconnection.logger.debug("Finished configuring. Caling execute(this)...");var result=actionObject.execute(this);mljs.defaultconnection.logger.debug("Got result: "+JSON.stringify(result));}
mljs.defaultconnection.logger.debug("COMPLETE processing onload actions");}
mljs.defaultconnection.logger.debug("finished loading page");};com.marklogic.widgets.workplace.prototype.getContextObject=function(name){return this._contexts[name];};com.marklogic.widgets.workplace._getWidgetClass=function(type){var wobj=com;var splits=type.split(".");for(var i=1,max=splits.length,split;i<max;i++){split=splits[i];wobj=wobj[split];}
return wobj;};com.marklogic.widgets.workplace.prototype._createWidget=function(type,elementid,config){mljs.defaultconnection.logger.debug("workplace._createWidget: Creating widget: "+type+" in "+elementid+" with config: "+JSON.stringify(config));var wobj=com.marklogic.widgets.workplace._getWidgetClass(type);mljs.defaultconnection.logger.debug("workplace._createWidget: instantiating widget: "+JSON.stringify(wobj));var wgt=new wobj(elementid);mljs.defaultconnection.logger.debug("workplace._createWidget: has widget instance been created? type is object?: "+(typeof wgt));if(undefined!==wgt.setConfiguration){wgt.setConfiguration(config);}
return wgt;};com.marklogic.widgets.layouts={};com.marklogic.widgets.layouts.helper={};com.marklogic.widgets.layouts.helper.prune=function(assignmentArray){};com.marklogic.widgets.layouts.helper.extendLayout=function(layoutInstance,container,zones){var self=layoutInstance;self.container=container;self.zones={};self.zoneNames=zones;for(var i=0,max=zones.length,zone;i<max;i++){zone=zones[i];self.zones[zone]=new Array();}
self._nextID=1;self.getAssignmentByWidgetName=function(widgetname){return self._overZones(function(item){if(undefined!=item&&"object"==typeof(item)){if(item.widget==widgetname){return true;}}
return false;});};self._overZones=function(matcher){for(var z in self.zones){mljs.defaultconnection.logger.debug("_overZones: fetching zone named: "+z);var zone=self.zones[z];if(undefined!=zone){mljs.defaultconnection.logger.debug("_overZones: Looping through zone containers");mljs.defaultconnection.logger.debug("_overZones: typeof zone: "+typeof(zone));for(var i=1,max=zone.length,item;i<max;i++){item=zone[i];mljs.defaultconnection.logger.debug("_overZones: got container number "+i+" with item type: "+typeof(item));if("object"==typeof(item)){mljs.defaultconnection.logger.debug("_overZones: item json content: "+JSON.stringify(item));}
if(matcher(item)){var mj={item:item,zone:z,order:i};mljs.defaultconnection.logger.debug("_overZones: Container "+i+" matches. Returning match JSON: "+JSON.stringify(mj));return mj;}}}}
mljs.defaultconnection.logger.debug("_overZones: No zone container matches at all. Returning null");return null;};self.getAssignmentByPlaceholder=function(elid){mljs.defaultconnection.logger.debug("getAssignmentByPlaceholder: Called for elid: "+elid);return self._overZones(function(item){mljs.defaultconnection.logger.debug("getAssignmentByPlaceholder: overzones matcher called for elid: "+elid);if(undefined!=item){if("string"==typeof(item)){mljs.defaultconnection.logger.debug("getAssignmentByPlaceholder: item is string");if(item==elid){mljs.defaultconnection.logger.debug("getAssignmentByPlaceholder: string item '"+item+"' matches elid");return true;}}else{mljs.defaultconnection.logger.debug("getAssignmentByPlaceholder: item is JSON config");if(item.elementid==elid){mljs.defaultconnection.logger.debug("getAssignmentByPlaceholder: JSON config '"+item.elementid+"' matches elid");return true;}}}else{}
mljs.defaultconnection.logger.debug("getAssignmentByPlaceholder: item not a match for elid. returning false");return false;})};self.getZoneList=function(){return self.zoneNames;};self.createZones=function(assignments){mljs.defaultconnection.logger.debug("Creating zones in thinthick layout");if(undefined!=assignments){for(var i=0,max=assignments.length,ass;i<max;i++){mljs.defaultconnection.logger.debug("layout<class>.createZones: i: "+i);ass=assignments[i];mljs.defaultconnection.logger.debug("layout<class>.createZones: i: "+i+" has ass: "+JSON.stringify(ass));self.zones[ass.zone][ass.order]=ass;}}
for(var zone in self.zones){self._genZones(zone,self.zones[zone]);}};self._getZone=function(zone){var z=self.zones[zone];if(undefined==z){z=[];self.zones[zone]=z;}
return z;};self.printZoneInfo=function(){var l=mljs.defaultconnection.logger.debug;for(var z in self.zones){var zone=self.zones[z];for(var i=0,max=zone.length,element;i<max;i++){element=zone[i];if(undefined!=element){if("string"==typeof(element)){l("layout.printZoneInfo: Zone: "+z+", index: "+i+", contains: Placeholder: "+element);}else{l("layout.printZoneInfo: Zone: "+z+", index: "+i+", contains: Widget: "+element.widget);}}}}};self._elementAt=function(zone,index){var z=self.zones[zone];if(undefined==z){return null;}
return z[index];};self.generateAssignments=function(){var ass=[];for(var zone in self.zones){var z=self.zones[zone];for(var o=2,max=z.length,wgt;o<max;o+=2){wgt=z[o];if(undefined!=z[o]){ass.push({widget:wgt.widget,zone:zone,order:(o/2)});}}}
return ass;};self.createPlaceholder=function(zone){var lastOrder=self.zones[zone].length;if(0==lastOrder){lastOrder=1;}
var elid=self.container+"-"+zone+"-"+self._nextID++;self.zones[zone][lastOrder]=elid;if(undefined!=self._createPlaceholderHTMLOverride){self._createPlaceholderHTMLOverride(zone,elid);}else{var zoneel=document.getElementById(self.container+"-"+zone);var div=document.createElement("div");div.setAttribute("id",elid);zoneel.appendChild(div);}
return elid;};self.registerAssignment=function(placeholderelid,assignmentJsonOrWidgetName){var info=self.getAssignmentByPlaceholder(placeholderelid);if("string"==typeof(assignmentJsonOrWidgetName)){assignmentJsonOrWidgetName={widget:assignmentJsonOrWidgetName};}
self.zones[info.zone][info.order]=assignmentJsonOrWidgetName;assignmentJsonOrWidgetName.elementid=placeholderelid;assignmentJsonOrWidgetName.order=info.order;assignmentJsonOrWidgetName.zone=info.zone;return assignmentJsonOrWidgetName;};self._genZones=function(zone,arr){mljs.defaultconnection.logger.debug("layout<class>._genZones: "+zone+" with array: "+JSON.stringify(arr));for(var i=1,max=arr.length,ass;i<max;i++){mljs.defaultconnection.logger.debug("layout<class>._genZones: zone: "+zone+" index: "+i);ass=arr[i];var elid=self.createPlaceholder(zone);var newAss=self.registerAssignment(elid,ass);}};self.moveToPosition=function(widgetName,newZone,newIndexOneBased){mljs.defaultconnection.logger.debug("layout<subclass>.moveToPosition: Entered");var wgt=self._elementAt(newZone,newIndexOneBased);var me=self.getAssignmentByWidgetName(widgetName).item;var spacer=self._elementAt(me.zone,me.order-1);var oldZone=me.zone;var oldOrder=me.order;mljs.defaultconnection.logger.debug("layout<subclass>.moveToPosition: Got Widget at target position. Moving those afterwards");var z=self.zones[newZone];var lastWidget=null;for(var w=z.length-1,min=z.length-3,moveme;w>=min&&null==lastWidget;w--){moveme=z[w];if(undefined!=moveme){lastWidget=moveme;}}
self._eliminateBlanks(z);if(undefined==newIndexOneBased){lastWidget=z[lastWidget.order-2];wgt=lastWidget;newIndexOneBased=wgt.order;var lastWidgetPos=wgt.order;z[me.order+1]=wgt;z[lastWidgetPos]=undefined;wgt.order=me.order+1;z[lastWidgetPos]=spacer;spacer.order=lastWidgetPos;z[lastWidgetPos+1]=me;me.order=lastWidgetPos+1;z[lastWidgetPos+2]=wgt;wgt.order=lastWidgetPos+2;z[lastWidgetPos+3]=undefined;}else{if(null!=wgt){if(null!=lastWidget&&lastWidget.elementid==wgt.elementid){z[newIndexOneBased+2]=z[newIndexOneBased];z[newIndexOneBased]=undefined;if(1==z.length%2){z[newIndexOneBased+1]=undefined;}
lastWidget.order+=2;self.zones[oldZone][oldOrder]=undefined;self.zones[oldZone][oldOrder-1]=undefined;}else{for(var w=z.length-1,min=newIndexOneBased,moveme;w>=min;w--){moveme=z[w];if(undefined!=moveme){moveme.order+=2;z[w+2]=moveme;z[w]=undefined;}}}}
mljs.defaultconnection.logger.debug("layout<subclass>.moveToPosition: Getting widget to move");me.order=newIndexOneBased+1;me.zone=newZone;spacer.order=newIndexOneBased;spacer.zone=newZone;z[newIndexOneBased]=spacer;z[newIndexOneBased+1]=me;if(null==lastWidget||lastWidget.elementid!=wgt.elementid){var diff=0;if(newZone==oldZone){diff=2;}
self.zones[oldZone][oldOrder+diff]=undefined;self.zones[oldZone][oldOrder-1+diff]=undefined;}}
mljs.defaultconnection.logger.debug("layout<subclass>.moveToPosition: Moving (decrementing order) widgets passed original position");z=self.zones[oldZone];self._eliminateBlanks(z);mljs.defaultconnection.logger.debug("layout<subclass>.moveToPosition: Moving HTML element");self._moveElementToPosition(me,spacer,wgt);mljs.defaultconnection.logger.debug("layout<subclass>.moveToPosition: Ended");};self._eliminateBlanks=function(z){var foundGap=0;var maxOrder=0;for(var w=1,max=z.length,moveme;w<max;w++){moveme=z[w];if(undefined==moveme){foundGap++;}else{if(foundGap>0){moveme.order=w-foundGap;z[w-foundGap]=z[w];z[w]=undefined;}
maxOrder=moveme.order;}}
for(var w=maxOrder+1,max=z.length,moveme;w<max;w++){z[w]=undefined;}};self._moveElementToPosition=function(me,spacer,wgt){mljs.defaultconnection.logger.debug("layout<subclass>._moveElementToPosition: Entered");if(undefined!=self._moveElementToPositionOverride){mljs.defaultconnection.logger.debug("layout<subclass>._moveElementToPosition: Caling override");self._moveElementToPositionOverride(me,spacer,wgt);}else{mljs.defaultconnection.logger.debug("layout<subclass>._moveElementToPosition: Moving element position");var movingel=document.getElementById(me.elementid);var currentel=document.getElementById(wgt.elementid);mljs.defaultconnection.logger.debug("layout<subclass>._moveElementToPosition: movingelid: "+me.elementid+", currentelid: "+wgt.elementid);currentel.parentNode.insertBefore(movingel,currentel);if(null!=spacer){mljs.defaultconnection.logger.debug("layout<subclass>._moveElementToPosition: Moving spacer with html elid: "+spacer.elementid);var spacerel=document.getElementById(spacer.elementid);currentel.parentNode.insertBefore(spacerel,movingel);}}
mljs.defaultconnection.logger.debug("layout<subclass>._moveElementToPosition: Ended");};};com.marklogic.widgets.layouts.thinthick=function(container){com.marklogic.widgets.layouts.helper.extendLayout(this,container,["A","B"]);this._init();};com.marklogic.widgets.layouts.thinthick.prototype._init=function(){var s="<div id='"+this.container+"-layout' class='container_12 mljswidget layout thinthick'>";s+="<div id='"+this.container+"-A' class='grid_4 thinthick-thin'></div>";s+="<div id='"+this.container+"-B' class='grid_8 thinthick-thick'></div>";s+="</div>";document.getElementById(this.container).innerHTML=s;};com.marklogic.widgets.layouts.thickthin=function(container){com.marklogic.widgets.layouts.helper.extendLayout(this,container,["A","B"]);this._init();};com.marklogic.widgets.layouts.thickthin.prototype._init=function(){var s="<div id='"+this.container+"-layout' class='container_12 mljswidget layout thickthin'>";s+="<div id='"+this.container+"-A' class='grid_8 thickthin-thick'></div>";s+="<div id='"+this.container+"-B' class='grid_4 thickthin-thin'></div>";s+="</div>";document.getElementById(this.container).innerHTML=s;};com.marklogic.widgets.layouts.column=function(container){com.marklogic.widgets.layouts.helper.extendLayout(this,container,["A"]);this._init();};com.marklogic.widgets.layouts.column.prototype._init=function(){var s="<div id='"+this.container+"-layout' class='container_12 mljswidget layout column'>";s+="<div id='"+this.container+"-A' class='column'></div>";s+="</div>";document.getElementById(this.container).innerHTML=s;};com.marklogic.widgets.actions={};com.marklogic.widgets.actions.javascript=function(){this._config={targetObject:null,methodName:null,parameters:[]};};com.marklogic.widgets.actions.javascript.getConfigurationDefinition=function(){};com.marklogic.widgets.actions.javascript.prototype.setConfiguration=function(config){this._config=config;};com.marklogic.widgets.actions.javascript.prototype.execute=function(executionContext){if((null==this._config.targetObject)||(null==this._config.methodName)){return{executed:false,details:"targetObject or methodName are null"};}
var obj=executionContext.getContextObject(this._config.targetObject);mljs.defaultconnection.logger.debug("Got target object?: "+obj);mljs.defaultconnection.logger.debug("Fetching method name: "+this._config.methodName);var func=(obj[this._config.methodName]);mljs.defaultconnection.logger.debug("Got target object function: "+func);var result=func.call(obj);return{executed:true,result:result,details:"Method executed successfully"};};com.marklogic.widgets.workplacecontext=function(){this._json={shared:false,widgets:[],assignments:[],contexts:[],actions:{onload:[],onunload:[]},layout:"thinthick",title:"New Workplace",urls:[]};this._lastSaved=this._json;this._uri=null;this.db=mljs.defaultconnection;this._cachedPages=new Array();this._cached=false;this._instanceNames={};this.updatePublisher=new com.marklogic.events.Publisher();this._myPagesPublisher=new com.marklogic.events.Publisher();};com.marklogic.widgets.workplacecontext.prototype.loadMyPages=function(){var self=this;var ob=this.db.createOptions();ob.collectionConstraint().returnFacets(false).returnResults(true).pageLength(1000).raw();var qb=this.db.createQuery();qb.query(qb.collection("/config/workplace/page"));var sc=this.db.createSearchContext();sc.setOptions("mljsMyWorkplacePages",ob);sc.addResultsListener(function(results){if(true===results||false===results){return;}
var pages=new Array();for(var i=0,maxi=results.results.length,page;i<maxi;i++){page=results.results[i].content;pages.push(page);}
self._myPagesPublisher.publish(pages);});sc.doStructuredQuery(qb.toJson());};com.marklogic.widgets.workplacecontext.prototype.getCachedPages=function(){if(false===this._cached){this.loadMyPages();}
return this._cachedPages;};com.marklogic.widgets.workplacecontext.prototype.resetWidgetConfig=function(){this._json.widgets=[];this._json.assignments=[];};com.marklogic.widgets.workplacecontext.prototype.nextWidgetName=function(classname){var classString=classname.split(".").pop();var next=this._instanceNames[classString];if(undefined==next){next=1;this._instanceNames[classString]=2;}
return classString+next;};com.marklogic.widgets.workplacecontext.prototype._addWidgetName=function(shortname){var matches=shortname.match(/\d+$/);if(matches){var number=matches[0];var endPos=shortname.indexOf(number);var classString=shortname.substring(0,endPos);number=parseInt(number,10);var next=this._instanceNames[classString];if(undefined==next){next=0;}
if(next<number){this._instanceNames[classString]=number+1;}}else{throw new TypeError("shortname: "+shortname+" not a valid widget short name - no number at end of name.");}};com.marklogic.widgets.workplacecontext.prototype.revert=function(){this._json=this._lastSaved;};com.marklogic.widgets.workplacecontext.prototype.setWorkplaceUri=function(uri){this._uri=uri;};com.marklogic.widgets.workplacecontext.prototype.save=function(callback){var self=this;this.saveWorkplace(this._json,this._uri,null,function(result){console.log("WORKPLACE SAVED");self._fireUpdate();callback();});};com.marklogic.widgets.workplacecontext.prototype.getWorkplace=function(name,callback){this.db.get("/admin/workplace/"+encodeURI(name)+".json",callback);};com.marklogic.widgets.workplacecontext.prototype.saveWorkplace=function(json,uri_opt,props_opt,callback){var col=null;if(undefined!=props_opt){col=props_opt.collection;}
var wpcols="mljsInternalData,mljsWorkplacePages,/config/workplace/page";if(undefined==col){col=wpcols;}else{col=col+","+wpcols;}
if(undefined==props_opt){props_opt={};}
props_opt.collection=col;this.db.save(json,uri_opt||"/admin/workplace/"+this.__genid()+".json",props_opt,callback);};com.marklogic.widgets.workplacecontext.prototype.findWorkplace=function(pageurl,callback){var ob=this.db.createOptions();ob.valueConstraint("pageurl","pageurl",ob.JSON).returnFacets(false).returnResults(true).raw();var qb=this.db.createQuery();qb.query(qb.value("pageurl",pageurl));var sc=this.db.createSearchContext();sc.setOptions("mljsFindWorkplace",ob);sc.addResultsListener(function(results){if(true===results||false===results){return;}
callback({inError:false,doc:results.results[0]});});sc.doStructuredQuery(qb.toJson());};com.marklogic.widgets.workplacecontext.prototype.listSharedWorkplaces=function(callback){};com.marklogic.widgets.workplacecontext.prototype.getJson=function(){return this._json;};com.marklogic.widgets.workplacecontext.prototype.getSummary=function(){return{title:this._json.title,urls:this._json.urls,layout:this._json.layout,shared:this._json.shared};};com.marklogic.widgets.workplacecontext.prototype.setSummary=function(title,urls,layout,shared){this._json.title=title;this._json.urls=urls;this._json.layout=layout;this._json.shared=shared;};com.marklogic.widgets.workplacecontext.prototype.getWidgets=function(){return this._json.widgets;};com.marklogic.widgets.workplacecontext.prototype.addWidget=function(name,type,config){var wgt={widget:name,type:type,config:config};this._addWidgetName(name);this._json.widgets.push(wgt);return wgt;};com.marklogic.widgets.workplacecontext.prototype.removeWidget=function(name){var wgts=[];for(var i=0;i<this._json.widgets.length;i++){if(this._json.widgets[i].name==name){}else{wgts.push(this._json.widgets[i]);}}
this._json.widgets=wgts;};com.marklogic.widgets.workplacecontext.prototype.getAssignments=function(){return this._json.assignments;};com.marklogic.widgets.workplacecontext.prototype.setAssignments=function(assignments){this._json.assignments=assignments;};com.marklogic.widgets.workplacecontext.prototype.placeWidget=function(name,zone,order){var zoneWidgets=[];var otherWidgets=[];var maxo=0;for(var i=0,w,max=this._json.assignments.length;i<max;i++){w=this._json.assignments[i];if(w.zone==zone){zoneWidgets[w.order-1]=w;maxo=w.order;}else{otherWidgets.push(w);}}
for(var i=maxo-1;i>order-1;i--){zoneWidgets[maxo]=zoneWidgets[maxo-1];zoneWidgets[maxo].order++;zoneWidgets[maxo-1]=undefined;}
zoneWidgets[order-1]={widget:name,zone:zone,order:order};var places=[];for(var i=0;i<otherWidgets.length;i++){places.push(otherWidgets[i]);}
for(var i=0;i<zoneWidgets.length;i++){places.push(zoneWidgets[i]);}
this._json.assignments=places;};com.marklogic.widgets.workplacecontext.prototype.getContexts=function(){return this._json.contexts;};com.marklogic.widgets.workplacecontext.prototype.addContext=function(name,type,config){this._json.contexts.push({context:name,type:type,config:config,register:[]});};com.marklogic.widgets.workplacecontext.prototype.registerWidget=function(widgetName,contextName){for(var i=0,max=this._json.contexts.length,c;i<max;i++){c=this._json.contexts[i];if(c.context==contextName){c.register.push(widgetName);return;}}};com.marklogic.widgets.workplacecontext.prototype.setWidgetConfig=function(widgetName,config){for(var i=0,max=this._json.widgets.length,w;i<max;i++){w=this._json.widgets[i];if(w.widget==widgetName){w.config=config;return;}}};com.marklogic.widgets.workplacecontext.prototype.getWidgetInfo=function(widgetName){mljs.defaultconnection.logger.debug("workplacecontext.getWidgetInfo: Finding config for: "+widgetName);for(var i=0,max=this._json.widgets.length,w;i<max;i++){mljs.defaultconnection.logger.debug("workplacecontext.getWidgetInfo: Checking widget with pos: "+i);w=this._json.widgets[i];mljs.defaultconnection.logger.debug("workplacecontext.getWidgetInfo: widget: "+JSON.stringify(w));if(w.widget==widgetName){mljs.defaultconnection.logger.debug("workplacecontext.getWidgetInfo: Match!");return w;}}
return null;};com.marklogic.widgets.workplacecontext.prototype.getActions=function(){return this._json.actions;};com.marklogic.widgets.workplacecontext.prototype.addOnloadAction=function(type,config){this._json.actions.onload.push({type:type,config:config});};com.marklogic.widgets.workplacecontext.prototype.addOnUnloadAction=function(type,config){this._json.actions.onunload.push({type:type,config:config});};com.marklogic.widgets.workplacecontext.prototype.addContextAction=function(contextName,event,actiontype,actionconfig){};com.marklogic.widgets.workplacecontext.prototype._processConfig=function(){for(var i=0,max=this._json.widgets.length,wgt;i<max;i++){wgt=this._json.widgets[i];this._addWidgetName(wgt.widget);}};com.marklogic.widgets.workplacecontext.prototype.loadPage=function(jsonOrString,json_opt){mljs.defaultconnection.logger.debug("workplacecontext.loadPage: value: "+jsonOrString);if(typeof(jsonOrString)=="string"){mljs.defaultconnection.logger.debug("workplacecontext.loadPage: Got server URI workplace page definition");var self=this;this.findWorkplace(jsonOrString,function(result){if(result.inError&&undefined!=json_opt){self._uri=jsonOrString;self._json=json_opt;}else{if(undefined!=result.doc){self._uri=result.doc.uri;self._json=result.doc.content;}else{self._uri=jsonOrString;self._json=json_opt;}}
if(undefined!=self._json){if("string"==typeof(self._json)){self._json=JSON.parse(self._json);}
self._lastSaved=self._json;self._processConfig();self._fireUpdate();}});}else{mljs.defaultconnection.logger.debug("workplacecontext.loadPage: Got JSON string workplace page definition");this._json=jsonOrString;this._lastSaved=this._json;this._processConfig();this._fireUpdate();}};com.marklogic.widgets.workplacecontext.prototype.loadPageWithUri=function(uri){this._uri=uri;var self=this;this.getWorkplace(uri,function(result){self._json=result.doc;self._lastSaved=self._json;self._processConfig();self._fireUpdate();});};com.marklogic.widgets.workplacecontext.prototype.register=function(widget){if(undefined!=widget.setWorkplaceContext){widget.setWorkplaceContext(this);}
if(undefined!=widget.updateWorkplace){this.addWorkplaceUpdateListener(function(wp){widget.updateWorkplace(wp);});}
if(undefined!=widget.updateMyPages){this._myPagesPublisher.subscribe(function(pages){widget.updateMyPages(pages);});}};com.marklogic.widgets.workplacecontext.prototype._fireUpdate=function(){this.updatePublisher.publish(this);};com.marklogic.widgets.workplacecontext.prototype.addWorkplaceUpdateListener=function(lis){this.updatePublisher.subscribe(lis);};com.marklogic.widgets.workplacecontext.prototype.removeWorkplaceUpdatelistener=function(lis){this.updatePublisher.unsubscribe(lis);};com.marklogic.widgets.workplaceadmin=function(container){this.container=container;this._workplaceContext=new com.marklogic.widgets.workplacecontext();this._config={widgetList:[{title:"Co-occurence",classname:"com.marklogic.widgets.cooccurence",description:"Shows two way co-occurence between elements in a document."},{title:"Document Properties",classname:"com.marklogic.widgets.docproperties",description:"Shows the MarkLogic Properties of a Document."},{title:"XHTML Head Viewer",classname:"com.marklogic.widgets.docheadviewer",description:"Shows the Meta data elements within an XHTML document."},{title:"XHTML Content Viewer",classname:"com.marklogic.widgets.docviewer",description:"Displays XHTML content inline within a page."},{title:"Data Explorer",classname:"com.marklogic.widgets.explorer",description:"HighCharts powered node diagram to explore semantic subjects and related document facets."},{title:"HighCharts",classname:"com.marklogic.widgets.highcharts",description:"HighCharts powered charting."},{title:"Google Kratu",classname:"com.marklogic.widgets.kratu",description:"Google Kratu tabular display of content and semantic search results."},{title:"OpenLayers Map",classname:"com.marklogic.widgets.openlayers",description:"OpenLayers powered map supporting multiple layer types and geospatial search"},{title:"Search Bar",classname:"com.marklogic.widgets.searchbar",description:"Content search query box supporting the default grammar."},{title:"Search Sorter",classname:"com.marklogic.widgets.searchsort",description:"Sort search results based on existing sorting options."},{title:"Search Pager",classname:"com.marklogic.widgets.searchpager",description:"Page through search results."},{title:"Search Facets",classname:"com.marklogic.widgets.searchfacets",description:"Show facets returned from a search, and allow their selection."},{title:"Search Results",classname:"com.marklogic.widgets.searchresults",description:"Show search results. Supports built in and custom rendering."},{title:"Search Results Selection",classname:"com.marklogic.widgets.searchselect",description:"List documents selected in Search Results."},{title:"Structured Search Selection",classname:"com.marklogic.widgets.searchselection",description:"Select a structured search to execute."},{title:"Semantic Search Bar",classname:"com.marklogic.widgets.sparqlbar",description:"Visually create a sophisticated SPARQL query."},{title:"Semantic Search Results",classname:"com.marklogic.widgets.sparqlresults",description:"Show a summary of Subjects returned from a SPARQL query."},{title:"Semantic Subject Facts",classname:"com.marklogic.widgets.entityfacts",description:"Show the list of facts about a specific subject."}],layoutList:[{title:"Thin Thick",classname:"com.marklogic.widgets.layouts.thinthick",description:"Sidebar column on left of main column"},{title:"Thick Thin",classname:"com.marklogic.widgets.layouts.thickthin",description:"Sidebar column on right of main column"},{title:"Column",classname:"com.marklogic.widgets.layouts.column",description:"Single column, content widgets are horizontal panels"}]};this.closePublisher=new com.marklogic.events.Publisher();this._currentTab="page";this._nextID=1;this._configWrappers=new Array();this._refresh();};com.marklogic.widgets.workplaceadmin.prototype.addSupportedWidgets=function(widgetDefArray){for(var i=0,max=widgetDefArray.length,def;i<max;i++){def=widgetDefArray[i];this._config.widgetList.push(def);}};com.marklogic.widgets.workplaceadmin.prototype.addSupportedLayouts=function(layoutDefArray){for(var i=0,max=layoutDefArray.length,def;i<max;i++){def=layoutDefArray[i];this._config.layoutList.push(def);}};com.marklogic.widgets.workplaceadmin.prototype.getWidgetSummary=function(widgetclass){for(var i=0,max=this._config.widgetList.length,wc;i<max;i++){wc=this._config.widgetList[i];if(wc.classname==widgetclass){return wc;}}
return null;};com.marklogic.widgets.workplaceadmin.renderFullscreen=function(workplacecontext){var el=document.createElement("div");el.id="workplaceeditormain";document.body.appendChild(el);var admin=new com.marklogic.widgets.workplaceadmin("workplaceeditormain");workplacecontext.register(admin);admin.updateWorkplace(workplacecontext);admin.addCloseListener(function(wgt){document.body.removeChild(document.getElementById("workplaceeditormain"));});};com.marklogic.widgets.workplaceadmin.prototype.addCloseListener=function(lis){this.closePublisher.subscribe(lis);};com.marklogic.widgets.workplaceadmin.prototype.removeCloseListener=function(lis){this.closePublisher.unsubscribe(lis);};com.marklogic.widgets.workplaceadmin.prototype.setWorkplaceContext=function(ctx){mljs.defaultconnection.logger.debug("workplaceadmin.setWorkplaceContext: called.");this._workplaceContext=ctx;};com.marklogic.widgets.workplaceadmin.prototype.getWorkplaceContext=function(){return this._workplaceContext;};com.marklogic.widgets.workplaceadmin.prototype._refresh=function(){var str="<div id='"+this.container+"-workplaceadmin' class='mljswidget workplaceadmin'>";str+=" <div id='"+this.container+"-panels' class='workplaceadmin-panels'>";str+="  <h2 class='title'>Edit Workplace Page</h2>";str+="  <div id='"+this.container+"-page-heading' class='workplaceadmin-page-heading subtitle active'>Page Settings</div>";str+="  <div id='"+this.container+"-page-content' class='workplaceadmin-page-content'>";str+="<table class='mljstable'>";str+="<tr><td>Page Title:</td><td><input type='text' size='25' id='"+this.container+"-page-title' /></td></tr>";str+="<tr><td>URL(s):</td><td><textarea cols='22' rows='4' id='"+this.container+"-page-urls'></textarea></td></tr>";str+="<tr><td>Main Layout:</td><td>";str+=" <select id='"+this.container+"-page-layout'>";for(var i=0,l,max=this._config.layoutList.length;i<max;i++){l=this._config.layoutList[i];var splits=l.classname.split(".");var shortname=splits[splits.length-1];str+="  <option value='"+shortname+"' title='"+l.description+"' id='"+this.container+"-layoutselect-"+shortname+"'>"+l.title+"</option>";}
str+=" </select>";str+="</td></tr>";str+="</table>";str+="  </div>";str+="  <div id='"+this.container+"-widgets-heading' class='workplaceadmin-widgets-heading subtitle active'>Widgets</div>";str+="  <div id='"+this.container+"-widgets-content' class='workplaceadmin-widgets-content hidden'>";str+="<table class='mljstable workplaceadmin-widgets-list'>"
for(var i=0,col=0,max=this._config.widgetList.length,w;i<max;i++){w=this._config.widgetList[i];col=i%3;if(0==col){str+="<tr>";}
str+="<td id='"+this.container+"-widgets-"+i+"' title='"+w.title+"'>";str+="<div class='workplaceadmin-widgets-list-img' id='"+this.container+"-widgets-"+i+"-img'"
if(undefined!=w.icon&&""!=w.icon){str+=" style='background-image: url("+w.icon+");'";}
str+=" draggable='true'><div class='workplaceadmin-widgets-list-span'>"+w.title+"</div></div>";str+="</td>";if(2==col){str+="</tr>";}}
if(col<2&&i>0){str+="</tr>";}
str+="</table>";str+="  </div>";str+="  <div id='"+this.container+"-contexts-heading' class='workplaceadmin-contexts-heading subtitle active'>Contexts</div>";str+="  <div id='"+this.container+"-contexts-content' class='workplaceadmin-contexts-content hidden'>TODO</div>";str+="  <div id='"+this.container+"-actions-heading' class='workplaceadmin-actions-heading subtitle active'>Actions</div>";str+="  <div id='"+this.container+"-actions-content' class='workplaceadmin-actions-content hidden'>TODO</div>";str+="  <div class='workplaceadmin-buttonbar'>";str+="   <input class='btn btn-primary' id='"+this.container+"-save' value='Save' type='submit' />";str+="   <input class='btn btn-secondary' id='"+this.container+"-cancel' value='Cancel' type='submit' />";str+="  </div>";str+=" </div>";str+=" <div id='"+this.container+"-config' class='workplaceadmin-config container_12'>";str+=" </div>";str+="</div>";document.getElementById(this.container).innerHTML=str;for(var i=0,col=0,max=this._config.widgetList.length,w;i<max;i++){w=this._config.widgetList[i];com.marklogic.widgets.dnd.onto(this.container+"-widgets-"+i+"-img","widgetclass",["layoutzone"],{type:"widgetclass",data:w.classname});}
var self=this;document.getElementById(this.container+"-page-heading").onclick=function(evt){self._showTab("page");};document.getElementById(this.container+"-widgets-heading").onclick=function(evt){self._showTab("widgets");};document.getElementById(this.container+"-contexts-heading").onclick=function(evt){self._showTab("contexts");};document.getElementById(this.container+"-actions-heading").onclick=function(evt){self._showTab("actions");};document.getElementById(this.container+"-cancel").onclick=function(evt){self._workplaceContext.revert();self.closePublisher.publish(true);};document.getElementById(this.container+"-save").onclick=function(evt){self._persistTabChanges();self._workplaceContext.save(function(result){self.closePublisher.publish(true);});};};com.marklogic.widgets.workplaceadmin.prototype._persistTabChanges=function(){if("page"==this._currentTab){this._workplaceContext.setSummary(document.getElementById(this.container+"-page-title").value,document.getElementById(this.container+"-page-urls").innerHTML.split(","),document.getElementById(this.container+"-page-layout").value,false);}else if("widgets"==this._currentTab){this._saveLayout();}};com.marklogic.widgets.workplaceadmin.prototype._showTab=function(tab){this._persistTabChanges();mljs.defaultconnection.logger.debug("workplaceadmin._showTab: Showing "+tab);com.marklogic.widgets.hide(document.getElementById(this.container+"-page-content"),("page"!=tab));com.marklogic.widgets.hide(document.getElementById(this.container+"-widgets-content"),("widgets"!=tab));com.marklogic.widgets.hide(document.getElementById(this.container+"-contexts-content"),("contexts"!=tab));com.marklogic.widgets.hide(document.getElementById(this.container+"-actions-content"),("actions"!=tab));this._currentTab=tab;};com.marklogic.widgets.workplaceadmin.prototype._saveLayout=function(){this._workplaceContext.resetWidgetConfig();for(var i=0,max=this._configWrappers.length,wrapper;i<max;i++){wrapper=this._configWrappers[i];this._workplaceContext.addWidget(wrapper.getWidgetName(),wrapper.getWidgetType(),wrapper.getWidgetConfig());}
var assignments=this._layout.generateAssignments();this._workplaceContext.setAssignments(assignments);};com.marklogic.widgets.workplaceadmin.prototype._addClassToZone=function(widgetclass,zone,order){var self=this;var dzElid=this._layout.createPlaceholder(zone);var insert=new com.marklogic.widgets.dropzone(dzElid);var iAss=this._layout.registerAssignment(dzElid,dzElid);this._addDzAccept(insert,iAss.zone,iAss.order,iAss.elementid);var wgtElid=this._layout.createPlaceholder(zone);var instanceName=self._workplaceContext.nextWidgetName(widgetclass);var widget=self._workplaceContext.addWidget(instanceName,widgetclass,{});var wgt=new com.marklogic.widgets.configwrapper(wgtElid);var wAss=this._layout.registerAssignment(wgtElid,instanceName);this._configWrappers.push(wgt);wgt.setWorkplaceContext(this._workplaceContext);wgt.onto("widgetconfig",["layoutposition"],{type:"widgetconfig",data:widget});var cfg=self._workplaceContext.getWidgetInfo(widget.widget);var cls=com.marklogic.widgets.workplace._getWidgetClass(cfg.type);if(undefined!=cls.getConfigurationDefinition){cls=cls.getConfigurationDefinition();}else{cls={};}
wgt.wrap(widget.widget,cls,cfg.config);this._layout.moveToPosition(widget.widget,zone,order);return widget;};com.marklogic.widgets.workplaceadmin.prototype._addDzAccept=function(aDrop,zone,position,layoutelementid){mljs.defaultconnection.logger.debug("addDzAccept called for: zone: "+zone+", order: "+position+", layoutelementid: "+layoutelementid);var self=this;aDrop.accept("layoutposition",["widgetclass"],function(data){var curPos=self._layout.getAssignmentByPlaceholder(layoutelementid).item;if("widgetclass"==data.type){mljs.defaultconnection.logger.debug("APPENDING INSERT WIDGET CLASS "+data+" ON TO DROP ZONE "+zone+" OF LAYOUT AT POSITION: "+position+", WITH CURRENT ZONE: "+curPos.zone+" AND ORDER: "+curPos.order);var widget=self._addClassToZone(data.data,curPos.zone,curPos.order);}else{mljs.defaultconnection.logger.debug("layout position widgetconfig drop handler called for: "+JSON.stringify(data));self._layout.moveToPosition(data.data.widget,curPos.zone,curPos.order);}});};com.marklogic.widgets.workplaceadmin.prototype.updateWorkplace=function(ctx){var json=this._workplaceContext.getJson();var self=this;mljs.defaultconnection.logger.debug("workplaceadmin.updateWorkplace: Creating layout");mljs.defaultconnection.logger.debug("workplaceadmin.updateWorkplace: Got JSON: "+JSON.stringify(json));this._layout=new(com.marklogic.widgets.layouts[json.layout])(this.container+"-config");var zones=this._layout.getZoneList();var zoneWidgets={};for(var z=0,maxz=zones.length,zone;z<maxz;z++){zone=zones[z];var zarray=zoneWidgets[zone];if(undefined==zarray){zarray=[];zoneWidgets[zone]=zarray;}
for(var a=0,maxa=json.assignments.length,ass;a<maxa;a++){ass=json.assignments[a];if(ass.zone==zone){zarray.push(ass);}}
bubbleSort(zarray,"order",true);}
var addBottomDz=function(zone){var dzElid=self._layout.createPlaceholder(zone);var bDrop=new com.marklogic.widgets.dropzone(dzElid);self._layout.registerAssignment(dzElid,dzElid);bDrop.accept("layoutposition",["widgetclass","widgetconfig"],function(data){console.log("APPENDING WIDGET CLASS "+data+" ON TO DROP ZONE "+zone+" OF LAYOUT");if("widgetclass"==data.type){self._addClassToZone(data.data,zone);}else{var curPos=self._layout.getAssignmentByPlaceholder(dzElid).item;self._layout.moveToPosition(data.data.widget,curPos.zone,curPos.order);}});};for(var z=0,maxz=zones.length,zone;z<maxz;z++){zone=zones[z];for(var w=0,maxw=zoneWidgets[zone].length,widget;w<maxw;w++){widget=zoneWidgets[zone][w];var dzElid=this._layout.createPlaceholder(zone);var aDrop=new com.marklogic.widgets.dropzone(dzElid);var dzAss=this._layout.registerAssignment(dzElid,dzElid);var wgtElid=this._layout.createPlaceholder(zone);var wgt=new com.marklogic.widgets.configwrapper(wgtElid);var wgtAss=this._layout.registerAssignment(wgtElid,widget.widget);this._addDzAccept(aDrop,zone,dzAss.order,dzElid);this._configWrappers.push(wgt);wgt.setWorkplaceContext(this._workplaceContext);wgt.onto("widgetconfig",["layoutposition"],{type:"widgetconfig",data:widget});var cfg=this._workplaceContext.getWidgetInfo(widget.widget);var cls=com.marklogic.widgets.workplace._getWidgetClass(cfg.type);if(undefined!=cls.getConfigurationDefinition){cls=cls.getConfigurationDefinition();}else{cls={};}
wgt.wrap(widget.widget,cls,cfg.config);}
addBottomDz(zone);}
document.getElementById(this.container+"-page-title").value=json.title;var str="";for(var i=0;i<json.urls.length;i++){if(i>0){str+=",";}
str+=json.urls[i];}
document.getElementById(this.container+"-page-urls").innerHTML=str;document.getElementById(this.container+"-page-layout").value=json.layout;this._layout.printZoneInfo();mljs.defaultconnection.logger.debug("workplaceadmin.updateWorkplace: Finished creating layout");};com.marklogic.widgets.dropzone=function(container){this.container=container;this._accepted=[];this._callback=null;this._init();};com.marklogic.widgets.dropzone.prototype._init=function(){var str="<div class='mljswidget dropzone'>";str+=" <div class='dropzone-target' id='"+this.container+"-target'>";str+="  <p class='dropzone-text'>Drop here</p>";str+=" </div>";str+="</div>";document.getElementById(this.container).innerHTML=str;};com.marklogic.widgets.dropzone.prototype.accept=function(dropzoneClass,draggableTypeAcceptArray,callback){com.marklogic.widgets.dnd.accept(this.container+"-target",dropzoneClass,draggableTypeAcceptArray,callback);};com.marklogic.widgets.configwrapper=function(container){this.container=container;mljs.defaultconnection.logger.debug("configwrapper: Constructor: Creating configwrapper within element with id: "+container);this._widgetName="";this._configDescription=null;this._config=null;this._workplaceContext=null;this.__nextID=1;this._init();};com.marklogic.widgets.configwrapper.prototype.getWidgetName=function(){return this._widgetName;};com.marklogic.widgets.configwrapper.prototype.getWidgetType=function(){return this._configDescription.type;};com.marklogic.widgets.configwrapper.prototype.getWidgetConfig=function(){return this._config;};com.marklogic.widgets.configwrapper.prototype.setWorkplaceContext=function(wpc){this._workplaceContext=wpc;};com.marklogic.widgets.configwrapper.prototype.getWorkplaceContext=function(){return this._workplaceContext;};com.marklogic.widgets.configwrapper.prototype.onto=function(draggableClass,droppableTypeAcceptArray,dataOrCallback){mljs.defaultconnection.logger.debug("configwrapper.onto: Adding drag handler for "+this.container+"-name");com.marklogic.widgets.dnd.onto(this.container+"-name",draggableClass,droppableTypeAcceptArray,dataOrCallback);};com.marklogic.widgets.configwrapper.prototype.wrap=function(widgetName,configDescription,currentConfig){this._widgetName=widgetName;this._configDescription=configDescription;this._config=currentConfig;this._updateWidgetConfig();};com.marklogic.widgets.configwrapper.prototype._updateWidgetConfig=function(){document.getElementById(this.container+"-name").innerHTML=this._widgetName;document.getElementById(this.container+"-cfg").innerHTML=this._genConfigHTML(this._config,this._configDescription,0);};com.marklogic.widgets.configwrapper.prototype._genConfigHTML=function(json,def,level){var gotConfig=false;var str="<table class='configwrapper-table'>";for(var name in json){gotConfig=true;var c=json[name];var d=def[name];str+="<tr>";var addtitle=function(){str+="<td title='"+d.description+"'>"+d.title+"</td><td>";};var conf={id:this.__nextID++,json:c,def:d};var self=this;if("string"==d.type){addtitle();var val=c||d.default;str+="<input type='text' id='"+this.container+"-"+conf.id+"' value='"+val.htmlEscape()+"' />";conf.addhandler=function(){var el=document.getElementById(this.container+"-"+conf.id);el.onchange=function(){json[name]=el.value;};};}else if("enum"==d.type){addtitle();var val=c||d.default;str+="<select id='"+this.container+"-"+conf.id+"' value='"+val.htmlEscape()+"'>";for(var i=0,opt,max=d.options.length;i<max;i++){opt=d.options[i];str+="<option value='"+opt.value+"' title='"+opt.description+"' ";if(opt.value==val){str+="selected='selected' ";}
str+=">"+opt.title+"</option>";}
str+="</select>";conf.addhandler=function(){var el=document.getElementById(this.container+"-"+conf.id);el.onchange=function(){json[name]=el.value;};};}else if("positiveInteger"==d.type){addtitle();var val=""+(c||d.default);str+="<input type='text' id='"+conf.id+"' value='"+val.htmlEscape()+"' />";str+="<span class='configwrapper-increment' id='"+this.container+"-"+conf.id+"-increment'>&nbsp;</span>";str+="<span class='configwrapper-decrement' id='"+this.container+"-"+conf.id+"-decrement'>&nbsp;</span>";conf.addhandler=function(){var el=document.getElementById(this.container+"-"+conf.id);el.onchange=function(){var val=el.value;try{if(((""+val)==(""+Math.floor(val)))&&((undefined==d.minimum)||(undefined!=d.minimum&&val>=d.minimum))&&((undefined==d.maximum)||(undefined!=d.maximum&&val<=d.maximum))){json[name]=val;}else{el.value=json[name];}}catch(numberex){el.value=json[name];}};};}else if("boolean"==d.type){addtitle();var val=c||d.default;str+="<input type='checkbox' name='"+this.container+"-"+conf.id+"' id='"+this.container+"-"+conf.id+"' ";if(true===val){str+="checked='checked' ";}
str+=">"+"</input>";conf.addhandler=function(){var el=document.getElementById(this.container+"-"+conf.id);el.onchange=function(){json[name]=el.checked;};};}else if("multiple"==d.type){str+="<td colspan='2'><div class='configwrapper-multiple-firstrow'>";str+="<span>"+d.title+":-</span>&nbsp;&nbsp;&nbsp;&nbsp;";str+="<span class='configwrapper-addmultiple' id='"+this.container+"-"+conf.id+"-add'>&nbsp;</span></div>";str+="<div class='configwrapper-multiple-indent'>";str+="<table class='configwrapper-multiple-table' id='"+this.container+"-"+conf.id+"-table'>";if(Array.isArray(c)){var gotrows=false;for(var i=0;i<c.length;i++){gotrows=true;str+="<tr><td>"+(i+1)+":&nbsp;<br/><span class='configwrapper-delmultiple' id='"+this.container+"-"+conf.id+"-del'>&nbsp;</span></td><td>";str+=this._genConfigHTML(c[i],d.childDefinitions,level+1);str+="</td></tr>";}
if(!gotrows){}}else{}
str+="</table>";str+="</div>";}
str+="</td></tr>";}
if(!gotConfig){str+="<tr><td><i>This widget cannot be configured</i></td></tr>";}
str+="</table>";return str;};com.marklogic.widgets.configwrapper.prototype._init=function(){var str="<div class='mljswidget configwrapper'>";str+=" <h3 class='subtitle' draggable='true' id='"+this.container+"-name'>"+this._widgetName+"</h3>";str+="<div id='"+this.container+"-cfg'>";str+=this._genConfigHTML(this._config,this._configDescription,0);str+="</div>";str+="</div>";document.getElementById(this.container).innerHTML=str;};com.marklogic.widgets.configwrapper.prototype.updateWorkplace=function(json){this._updateWidgetConfig();};com.marklogic.widgets.actionorderer=function(container){this.container=container;this._actions=null;this._wrappers={};this._init();};com.marklogic.widgets.actionorderer.prototype._init=function(){var s="<div class='mljswidget actionorderer' id='"+this.container+"-outer'>";s+="  <div class='actionorderer-actions' id='"+this.container+"-actions'></div>";s+="  <div class='actionorderer-drop' id='"+this.container+"-drop'></div>";s+="</div>";document.getElementById(this.container).innerHTML=s;};com.marklogic.widgets.actionorderer.prototype.wrap=function(actions){this._actions=actions;};com.marklogic.widgets.actionorderer.prototype.getActions=function(){return this._actions;};com.marklogic.widgets.actionconfig=function(container){this.container=container;this._config=null;this._init();};com.marklogic.widgets.actionconfig.prototype._init=function(){};com.marklogic.widgets.actionconfig.prototype.wrap=function(config){this._config=config;};com.marklogic.widgets.actionconfig.prototype.getConfig=function(){return this._config;};com.marklogic.widgets.workplacenavbar=function(container){this.container=container;this._workplaceContext=null;this._config={appName:"Workplace",homeUrl:"/index.html5",homeText:"Home",showAppConfigureLink:true,appConfigureLinkText:"Configure App",appConfigureUrl:"/application.html5",showPageConfigureLink:true,pageConfigureLinkText:"Configure Page",showLogoutLink:false,logoutLinkText:"Logout",logoutUrl:"/logout"};this._refresh();};com.marklogic.widgets.workplacenavbar.prototype.setWorkplaceContext=function(ctx){mljs.defaultconnection.logger.debug("workplacenavbar.setWorkplaceContext: called.");this._workplaceContext=ctx;};com.marklogic.widgets.workplacenavbar.prototype.getWorkplaceContext=function(){return this._workplaceContext;};com.marklogic.widgets.workplacenavbar.getConfigurationDefinition=function(){return{appName:{type:"string",default:"Workplace",title:"Application name",description:"Default application name (normally read from workplace app JSON)"},homeUrl:{type:"string",default:"/index.html5",title:"Home link URL",description:"Absolute URL of the home page. Blank for no home page link"},homeText:{type:"string",default:"Home",title:"Home link text",description:"The display text for the link"},showAppConfigureLink:{type:"boolean",default:true,title:"Show App Configure Link",description:"Show application configuration link"},appConfigureLinkText:{type:"string",default:"Configure App",title:"App Configure Link Text",description:"The display text for the link"},appConfigureUrl:{type:"string",default:"/application.html5",title:"Configure App Url",description:"The URL of the page managing app wide configuration"},showPageConfigureLink:{type:"boolean",default:true,title:"Show Page Configure Link",description:"Whether to show the link for this page's configuration"},pageConfigureLinkText:{type:"string",default:"Configure Page",title:"Page Configure Link Text",description:"The display text for the link"},showLogoutLink:{type:"boolean",default:false,title:"Show Logout Link",description:"Whether to show a link to the logout page"},logoutLinkText:{type:"string",default:"Logout",title:"Logout Link Text",description:"The display text for the link"},logoutUrl:{type:"string",default:"/logout",title:"Logout Link Url",description:"The URL for the logout handling server side process"}}};com.marklogic.widgets.workplacenavbar.prototype.setConfiguration=function(config){for(var prop in config){this._config[prop]=config[prop];}
this._refresh();};com.marklogic.widgets.workplacenavbar.prototype._refresh=function(){var s="<div class='mljswidget navbar navbar-default workplacenavbar' role='navigation'>";if(null!=this._config.homeUrl&&""!=this._config.homeUrl.trim()){s+="<div class='container-fluid'>"
s+="<div class='navbar-header'>"
s+="<button type='button' class='navbar-toggle' data-toggle='collapse' data-target='.navbar-collapse'>"
s+="<span class='sr-only'>Toggle navigation</span>"
s+="<span class='icon-bar'></span>"
s+="<span class='icon-bar'></span>"
s+="<span class='icon-bar'></span>"
s+="</button>"
s+="<a class='navbar-brand' href='"+this._config.homeUrl+"'>"+this._config.appName+"</a>"
s+="</div>";}
s+="<div class='navbar-collapse collapse'><ul class='nav navbar-nav'>";if(null!=this._config.homeUrl&&""!=this._config.homeUrl.trim()){s+="<li class='active'><a href='"+this._config.homeUrl+"'>"+this._config.homeText+"</a></li>";}
if(null!=this._workplaceContext){var pages=this._workplaceContext.getCachedPages();for(var i=0,maxi=pages.length,page;i<maxi;i++){page=pages[i];s+="<li><a href='"+page.url+"'>"+page.title+"</a></li>";}}
s+="</ul><ul class='nav navbar-nav navbar-right'>";if(true===this._config.showAppConfigureLink){s+="<li><a id="+this.container+"-workplacenavbar-configureapp' href='"+this._config.appConfigureUrl+"'>"+this._config.appConfigureLinkText+"</a></li>";}
s+="<li><a href='#'>"+this._config.pageConfigureLinkText+"</a></li>";if(true===this._config.showLogoutLink){s+="<li><a href='"+this._config.logoutUrl+"'>"+this._config.logoutLinkText+"</a></li>";}
s+="</ul></div><!--/.nav-collapse --></div><!--/.container-fluid --></div>";document.getElementById(this.container).innerHTML=s;};