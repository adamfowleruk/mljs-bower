
com=window.com||{};com.marklogic=window.com.marklogic||{};com.marklogic.widgets=window.com.marklogic.widgets||{};com.marklogic.widgets.cooccurence=function(container){this.container=container;this.errorPublisher=new com.marklogic.events.Publisher();this.selectionPublisher=new com.marklogic.events.Publisher();this._config={title:"Co-occurence"};this.values=null;this.constraintArray=null;this._displayTuple=null;this._refresh();};com.marklogic.widgets.cooccurence.getConfigurationDefinition=function(){var self=this;return{title:{type:"string",default:"Co-occurence",title:"Title",description:"Title for this widget."}};};com.marklogic.widgets.cooccurence.prototype.setConfiguration=function(config){for(var prop in config){this._config[prop]=config[prop];}
this._refresh();};com.marklogic.widgets.cooccurence.prototype.displayTuple=function(tuplename){this._displayTuple=tuplename;};com.marklogic.widgets.cooccurence.prototype.addErrorListener=function(fl){this.errorPublisher.subscribe(fl);};com.marklogic.widgets.cooccurence.prototype.removeErrorListener=function(fl){this.errorPublisher.unsubscribe(fl);};com.marklogic.widgets.cooccurence.prototype.addFacetSelectionListener=function(fl){this.selectionPublisher.subscribe(fl);};com.marklogic.widgets.cooccurence.prototype.removeFacetSelectionListener=function(fl){this.selectionPublisher.unsubscribe(fl);};com.marklogic.widgets.cooccurence.prototype.updateValues=function(values){if("boolean"==typeof(values)){return;}
if(null==this._displayTuple||(undefined!=values["values-response"]&&this._displayTuple==values["values-response"].name)){this.values=values;this._refresh();}};com.marklogic.widgets.cooccurence.prototype._refresh=function(){mljs.defaultconnection.logger.debug("cooccurence.refresh");if(null==this.values||undefined==typeof this.values){return;}
mljs.defaultconnection.logger.debug("cooccurence.refresh: got results");var str="<div class='mljswidget panel panel-info'>";str+="<div class='panel-heading cooccurence-title'>"+this._config.title+"</div>";str+="<div class='panel-body cooccurence-content'>";var tuples=null;if(undefined!=this.values["values-response"]&&undefined!=this.values["values-response"].tuple){var tuplesOriginal=this.values["values-response"].tuple;bubbleSort(tuplesOriginal,"frequency");tuples=tuplesOriginal;for(var i=0;i<tuples.length;i++){str+="<div class='cooccurence-values'>";var t=tuples[i];for(var v=0;v<t["distinct-value"].length;v++){var val=t["distinct-value"][v];str+="<span class='cooccurence-value' id='"+this.container+"-tuple-"+i+"-value-"+v+"'>"+val["_value"]+"</span>";if(v!=t["distinct-value"].length-1){str+=", ";}}
str+=" <span class='badge cooccurence-count'>"+t.frequency+"</span></div>";}}
str+="</div></div>";document.getElementById(this.container).innerHTML=str;var addHandler=function(el,val,i,v){el.onclick=function(e){mljs.defaultconnection.logger.debug("cooccurence.refresh: facet selected: "+self.constraintArray[v]+"="+val["_value"]);self._select(self.constraintArray[v],val["_value"]);e.stopPropagation();return false;};};mljs.defaultconnection.logger.debug("cooccurence.refresh: checking for click handler support");var self=this;if(null!=this.constraintArray){if(undefined!=this.values["values-response"]&&undefined!=this.values["values-response"].tuple){mljs.defaultconnection.logger.debug("cooccurence.refresh: Got constraint array. Adding click handlers");for(var i=0;i<tuples.length;i++){mljs.defaultconnection.logger.debug("cooccurence.refresh: tuple: "+i);var t=tuples[i];for(var v=0;v<t["distinct-value"].length;v++){mljs.defaultconnection.logger.debug("cooccurence.refresh: value: "+v);var val=t["distinct-value"][v];var el=document.getElementById(this.container+"-tuple-"+i+"-value-"+v);mljs.defaultconnection.logger.debug("cooccurence.refresh: Adding click handler");addHandler(el,val,i,v);}}}}};com.marklogic.widgets.cooccurence.prototype.setTupleConstraints=function(constraintArray){this.constraintArray=constraintArray;};com.marklogic.widgets.cooccurence.prototype._select=function(facet,value){var sel={name:facet,value:value};this.selectionPublisher.publish([sel]);};